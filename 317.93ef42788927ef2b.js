"use strict";(self.webpackChunkDatHangAngular=self.webpackChunkDatHangAngular||[]).push([[317],{317:(ot,w,c)=>{c.r(w),c.d(w,{TmdtModule:()=>nt});var S=c(5263),_=c(6895),g=c(7486),v=c(7579),f=c(2722),y=c(8746),t=c(4650),M=c(8735),$=c(5849),b=c(7455),x=c(805),T=c(4505),N=c(9717),u=c(3970),k=c(1740),A=c(3054),D=c(7188),I=c(4076),J=c(3608),h=c(4006);function O(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"th",8)(2,"div",9),t._uU(3),t.qZA()(),t.BQk()),2&i){const e=d.$implicit;t.xp6(1),t.s9C("pSortableColumn",e.field),t.Q6J("ngClass",e.headerClassName)("ngStyle",e.styles),t.xp6(2),t.hij(" ",e.name," ")}}function Z(i,d){if(1&i&&(t.TgZ(0,"tr"),t.YNc(1,O,4,4,"ng-container",7),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.headers)}}function F(i,d){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"img",18,19),t.NdJ("click",function(){t.CHM(e);const o=t.MAs(2),a=t.oxw().$implicit,l=t.oxw().$implicit,r=t.oxw(),m=t.MAs(1);return t.KtG(r.openSelectFile(l,a.field,m,o))}),t.qZA(),t.BQk()}if(2&i){const e=t.oxw().$implicit,n=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.Q6J("src",null!==(a=n[e.field])&&void 0!==a?a:o.IMG_DEFAULT,t.LSH)}}function H(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"input",22),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit;return t.KtG(l[a.field]=o)})("change",function(){t.CHM(e);const o=t.oxw(2).$implicit,a=t.oxw().$implicit,l=t.oxw();return t.KtG(l.changeValue(a,o,a[o.field]))})("keydown",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit,r=t.oxw();return t.KtG(r.keyHandler(o,l,a,l[a.field]))}),t.qZA(),t.TgZ(1,"span",23),t._uU(2),t.qZA()}if(2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.Q6J("ngStyle",e.styles)("ngModel",n[e.field]),t.xp6(2),t.hij(" ",n[e.field],"")}}function Q(i,d){if(1&i&&t._uU(0),2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.hij(" ",n[e.field]," ")}}function Y(i,d){1&i&&(t.ynx(0),t.TgZ(1,"p-cellEditor"),t.YNc(2,H,3,3,"ng-template",20),t.YNc(3,Q,1,1,"ng-template",21),t.qZA(),t.BQk())}function L(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"p-inputNumber",24),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit;return t.KtG(l[a.field]=o)})("focusout",function(){t.CHM(e);const o=t.oxw(2).$implicit,a=t.oxw().$implicit,l=t.oxw();return t.KtG(l.changeValue(a,o,a[o.field]))})("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit,r=t.oxw();return t.KtG(r.commonService.autoCalculatePrices(l,a,o))})("keydown",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit,r=t.oxw();return t.KtG(r.keyHandler(o,l,a,l[a.field]))}),t.qZA()}if(2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.Q6J("ngModel",n[e.field])("inputStyle",e.styles)("minFractionDigits",0)("maxFractionDigits",5)}}function P(i,d){if(1&i&&(t._uU(0),t.ALo(1,"number")),2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.hij(" ",0==+n[e.field]?"-":t.lcZ(1,1,+n[e.field])," ")}}function E(i,d){1&i&&(t.ynx(0),t.TgZ(1,"p-cellEditor"),t.YNc(2,L,1,4,"ng-template",20),t.YNc(3,P,2,3,"ng-template",21),t.qZA(),t.BQk())}function K(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"textarea",25),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit;return t.KtG(l[a.field]=o)})("change",function(){t.CHM(e);const o=t.oxw(2).$implicit,a=t.oxw().$implicit,l=t.oxw();return t.KtG(l.changeValue(a,o,a[o.field]))})("keydown",function(o){t.CHM(e);const a=t.oxw(2).$implicit,l=t.oxw().$implicit,r=t.oxw();return t.KtG(r.keyHandler(o,l,a,l[a.field]))}),t.qZA()}if(2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.Q6J("ngStyle",e.styles)("ngModel",n[e.field])}}function U(i,d){if(1&i&&t._uU(0),2&i){const e=t.oxw(2).$implicit,n=t.oxw().$implicit;t.hij(" ",n[e.field]," ")}}function B(i,d){1&i&&(t.ynx(0),t.TgZ(1,"p-cellEditor"),t.YNc(2,K,1,2,"ng-template",20),t.YNc(3,U,1,1,"ng-template",21),t.qZA(),t.BQk())}const G=function(i){return{display:i}};function R(i,d){if(1&i&&(t.TgZ(0,"td",12)(1,"span",13),t._uU(2),t.qZA(),t.TgZ(3,"div",14),t.ynx(4,15),t.YNc(5,F,3,1,"ng-container",16),t.YNc(6,Y,4,0,"ng-container",16),t.YNc(7,E,4,0,"ng-container",16),t.YNc(8,B,4,0,"ng-container",17),t.BQk(),t.qZA()()),2&i){const e=d.$implicit,n=t.oxw().$implicit;t.Q6J("ngClass",e.className)("ngStyle",t.VKq(10,G,n["_hide_"+e.field]?"none":"table-cell")),t.uIk("rowspan",n["_rowspan_"+e.field]),t.xp6(2),t.Oqu(e.name),t.xp6(1),t.Q6J("ngStyle",e.styles)("pTooltip",n["tooltip_"+e.field]),t.xp6(1),t.Q6J("ngSwitch",e.type),t.xp6(1),t.Q6J("ngSwitchCase","image"),t.xp6(1),t.Q6J("ngSwitchCase","string"),t.xp6(1),t.Q6J("ngSwitchCase","number")}}const j=function(i){return{newly:i}};function z(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"tr",10),t.YNc(2,R,9,12,"td",11),t.qZA(),t.BQk()),2&i){const e=d.$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(3,j,n.checkNewlyUpdate(e.created)))("pContextMenuRow",e),t.xp6(1),t.Q6J("ngForOf",n.headers)}}const V=function(){return[10,25,50,100,500,1e3]},W=function(){return{flex:1,width:"100%"}};let X=(()=>{class i{constructor(e,n,o,a){this.toastService=e,this.confirmationService=n,this.firebaseService=o,this.commonService=a,this.dataTable=[],this.valueChanged=new t.vpe,this.contextMenuOutput=new t.vpe,this.renderLink=T.KJ,this.IMG_DEFAULT=T.jC,this.currentTime=Date.now()}ngOnInit(){this.contextMenu=[{label:"Clone a copy",icon:"pi pi-fw pi-copy",command:()=>this.cloneACopy()},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>this.confirmDelete()}]}ngOnChanges(e){this.currentTime=Date.now()}cloneACopy(){this.contextMenuOutput.emit({type:g.MW.CLONE_A_COPY,value:this.selectedItem}),this.selectedItem={}}confirmDelete(){this.confirmationService.confirm({message:`Do you want to delete this record: ${this.selectedItem.sku}?`,header:"Delete Confirmation",icon:"pi pi-info-circle",rejectButtonStyleClass:"bg-danger",accept:()=>{this.contextMenuOutput.emit({type:g.MW.DELETE_ACCEPT,value:this.selectedItem}),this.selectedItem={}},reject:e=>{this.contextMenuOutput.emit({type:g.MW.DELETE_REJECT_CANCEL,value:this.selectedItem}),this.selectedItem={}}})}openSelectFile(e,n,o,a){o.data={item:e,field:n,image:a},o.click()}changeValue(e,n,o){console.log({item:e},n,o),this.valueChanged.emit({item:e,header:n,value:o})}changeImg(e,n){console.log({fileElement:e},n),(0,T.pQ)(e,o=>{e.data.image.src=o,this.valueChanged.emit({item:e.data.item,header:{field:e.data.field},value:o})})}keyHandler(e,n,o,a){("Enter"===e.key||13===e.keyCode)&&(console.log("Enter",n),this.changeValue(n,o,a))}checkNewlyUpdate(e){return Date.now()-e<3e3}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(M.k),t.Y36(x.YP),t.Y36(b.O),t.Y36(N.v))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["tmdt-table"]],inputs:{dataTable:"dataTable",headers:"headers",isLoading:"isLoading"},outputs:{valueChanged:"valueChanged",contextMenuOutput:"contextMenuOutput"},features:[t.TTD],decls:7,vars:14,consts:[["type","file","accept","image/*",1,"d-none",3,"change"],["inputImg",""],[3,"model"],["cm",""],["responsiveLayout","stack","dataKey","_id","currentPageReportTemplate","{first} - {last} / {totalRecords}",1,"w-full",3,"value","breakpoint","rows","rowsPerPageOptions","paginator","showCurrentPageReport","contextMenuSelection","contextMenu","rowHover","tableStyle","loading","contextMenuSelectionChange"],["pTemplate","header"],["pTemplate","body"],[4,"ngFor","ngForOf"],[1,"table-header",3,"ngClass","ngStyle","pSortableColumn"],[1,"flex","align-items-center"],[3,"ngClass","pContextMenuRow"],[3,"ngClass","ngStyle",4,"ngFor","ngForOf"],[3,"ngClass","ngStyle"],[1,"p-column-title"],[1,"table-cell",3,"ngStyle","pTooltip"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"cursor-pointer",3,"src","click"],["image",""],["pTemplate","input"],["pTemplate","output"],["pInputText","",3,"ngStyle","ngModel","ngModelChange","change","keydown"],[1,"invisible"],["mode","decimal",3,"ngModel","inputStyle","minFractionDigits","maxFractionDigits","ngModelChange","focusout","keydown"],["pInputTextarea","",3,"ngStyle","ngModel","ngModelChange","change","keydown"]],template:function(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"input",0,1),t.NdJ("change",function(r){t.CHM(a);const m=t.MAs(1);return t.KtG(o.changeImg(m,r))}),t.qZA(),t._UZ(2,"p-contextMenu",2,3),t.TgZ(4,"p-table",4),t.NdJ("contextMenuSelectionChange",function(r){return o.selectedItem=r}),t.YNc(5,Z,2,1,"ng-template",5),t.YNc(6,z,3,5,"ng-template",6),t.qZA()}if(2&n){const a=t.MAs(3);t.xp6(2),t.Q6J("model",o.contextMenu),t.xp6(2),t.Q6J("value",o.dataTable)("breakpoint","960px")("rows",25)("rowsPerPageOptions",t.DdM(12,V))("paginator",!1)("showCurrentPageReport",!0)("contextMenuSelection",o.selectedItem)("contextMenu",a)("rowHover",!1)("tableStyle",t.DdM(13,W))("loading",o.isLoading)}},dependencies:[_.mk,_.sg,_.PC,_.RF,_.n9,_.ED,u.iA,x.jx,u.lQ,u.zi,u.YL,k.o,A.g,D.Rn,I.xV,J.u,h.Fj,h.JJ,h.On,_.JJ],styles:["[_nghost-%COMP%]     .newly td:nth-child(n+2){background-color:#d7ffe6}@media only screen and (min-width: 800px){[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{color:#fff;background:#11101d}[_nghost-%COMP%]     .p-datatable-wrapper{height:calc(100vh - 60px)}[_nghost-%COMP%]     .p-datatable-wrapper .p-datatable-thead{position:sticky;top:0;z-index:1}}"]})}return i})(),q=(()=>{class i{constructor(e,n,o,a){this.toastService=e,this.dialogService=n,this.firebaseService=o,this.confirmationService=a,this.numberDefaultConfig={name:"",field:"",type:"number",filter:{noFilter:!0},styles:{"text-align":"right"}},this.headers=[],this.orders=[],this.isLoading=!0,this.$destroy=new v.x}ngOnInit(){this.getTableHeader(),this.firebaseService.loadSetting(()=>{this.getData()})}valueChanged(e){}showAddModal(){}contextMenuClick(e){console.log(e)}getTableHeader(){this.headers=[{name:"SKU",field:"sku",type:"string",filter:{},styles:{"text-align":"center"}},{name:"Image",field:"imageLink",type:"image",className:"image-col",filter:{noFilter:!0},styles:{"text-align":"center"}},{name:"M\xc0U",field:"prop_color",type:"string",filter:{},styles:{"text-align":"center"}},{name:"SIZE",field:"prop_size",type:"string",filter:{},styles:{"text-align":"center"}},{...this.numberDefaultConfig,name:"\u0110\xc3 NH\u1eacP",field:"quantity"},{...this.numberDefaultConfig,name:"\u0110\xc3 B\xc1N",field:"orderID"},{...this.numberDefaultConfig,name:"GI\xc1 V\u1ed0N",field:"price",className:"text-danger"},{...this.numberDefaultConfig,name:"DOANH THU",className:"text-danger"},{name:"UPDATE",field:"",className:"text-danger",type:"string",filter:{},styles:{"text-align":"center"}}]}getData(){this.isLoading=!0,this.orders=[],this.firebaseService.getTmdt().pipe((0,f.R)(this.$destroy),(0,y.x)(()=>this.isLoading=!1)).subscribe(e=>{console.log(e),e.sort((n,o)=>n.created<o.created?1:-1),this.orders=this.groupByProps(e),this.orders=this.mergeColsRows(this.orders)})}mergeColsRows(e){let n=JSON.parse(JSON.stringify(e)),o={rowspan:0,currentSku:"",currentIndex:0},a={rowspan:0,current:"",currentIndex:0},l={rowspan:0,current:"",currentIndex:0};function r(s,p){n[o.currentIndex]._rowspan_sku=o.rowspan,n[o.currentIndex]._rowspan_imageLink=o.rowspan,o.currentIndex=s,o.rowspan=1,o.currentSku=p.sku??""}function m(s,p,it=!0){n[a.currentIndex]._rowspan_prop_color=a.rowspan,a.currentIndex=s,a.rowspan=1,a.current=p.prop_color??""}function C(s,p){n[l.currentIndex]._rowspan_prop_size=l.rowspan,l.currentIndex=s,l.rowspan=1,l.current=p.prop_size??""}for(let s=0;s<n.length;s++){const p=n[s];console.log(p),p.sku===o.currentSku?(n[s]._hide_sku=!0,n[s]._hide_imageLink=!0,o.rowspan++,s==n.length-1&&r(s,p),p.prop_color===a.current?(n[s]._hide_prop_color=!0,a.rowspan++,s==n.length-1&&m(s,p)):(m(s,p),p.prop_size===l.current?(n[s]._hide_prop_size=!0,l.rowspan++,s==n.length-1&&C(s,p)):C(s,p))):(r(s,p),m(s,p),C(s,p))}return console.log(n),n}groupByProps(e){const n=(0,g.bo)().map(l=>l.id);let o=JSON.parse(JSON.stringify(e));console.log("propsId",n),console.log("groupByProps before sort",e);const a=o.sort((l,r)=>l.sku===r.sku?l[n[0]]===r[n[0]]?l[n[1]]===r[n[1]]?(l.created||0)<(r.created||0)?1:-1:+l[n[1]]>+r[n[1]]?1:-1:l[n[0]]>r[n[0]]?1:-1:l.sku>r.sku?1:-1);return console.log("groupByProps",a),a}addItem(e){this.firebaseService.addTMDT(e).pipe((0,f.R)(this.$destroy)).subscribe(n=>{console.log("added",n),this.toastService.showToastSuccess(`Added new order ${e.sku} successfully!`),this.getData()})}updateItem(e,n,o){this.isLoading=!0,this.firebaseService.fbUpdateProducts(e,n).pipe((0,f.R)(this.$destroy),(0,y.x)(()=>this.isLoading=!1)).subscribe(a=>{this.toastService.showToastSuccess(`${o} successfully!`),this.ref.close(),this.getData()})}ngOnDestroy(){this.$destroy.next(),this.$destroy.complete(),this.ref&&this.ref.close()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(M.k),t.Y36($.xA),t.Y36(b.O),t.Y36(x.YP))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-tmdt"]],decls:1,vars:3,consts:[[3,"headers","dataTable","isLoading","valueChanged","contextMenuOutput"]],template:function(n,o){1&n&&(t.TgZ(0,"tmdt-table",0),t.NdJ("valueChanged",function(l){return o.valueChanged(l)})("contextMenuOutput",function(l){return o.contextMenuClick(l)}),t.qZA()),2&n&&t.Q6J("headers",o.headers)("dataTable",o.orders)("isLoading",o.isLoading)},dependencies:[X],styles:["[_nghost-%COMP%]     .image-col img{width:100px}"]})}return i})();var tt=c(3913);const et=[{path:"",component:q}];let nt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[_.ez,S.Bz.forChild(et),tt.m,h.u5]})}return i})()}}]);